<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SIMVEX MVP</title>
  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1426;
      --panel2:#0B1020;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,.08);
      --blue:#2E6BFF;
      --cyan:#00E5FF;
      --green:#3DFFB5;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo","Noto Sans KR";
      background:
        radial-gradient(1200px 600px at 10% 20%, rgba(46,107,255,.22), transparent 55%),
        radial-gradient(900px 500px at 80% 30%, rgba(0,229,255,.14), transparent 60%),
        radial-gradient(800px 500px at 60% 85%, rgba(61,255,181,.12), transparent 55%),
        var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1180px; margin:0 auto; padding:20px}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(12px);
      background: rgba(7,10,18,.58);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
      padding:14px 20px;
      max-width:1180px; margin:0 auto;
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width:180px;
      font-weight:800; letter-spacing:.2px;
    }
    .dot{
      width:12px; height:12px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, var(--cyan) 55%, transparent 70%),
                  radial-gradient(circle at 60% 70%, var(--blue), transparent 65%);
      box-shadow: 0 0 18px rgba(0,229,255,.35), 0 0 22px rgba(46,107,255,.25);
    }
    .nav{
      display:flex; align-items:center; gap:8px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      padding:6px;
      border-radius:999px;
    }
    .tab{
      padding:8px 14px;
      border-radius:999px;
      color:var(--muted);
      font-weight:650;
      font-size:13px;
      cursor:pointer;
      transition:.18s ease;
      user-select:none;
    }
    .tab:hover{color:var(--text); background: rgba(255,255,255,.05)}
    .tab.active{
      color:#fff;
      background: linear-gradient(135deg, rgba(46,107,255,.85), rgba(0,229,255,.45));
      box-shadow: 0 10px 30px rgba(46,107,255,.18);
    }
    .right-actions{display:flex; align-items:center; gap:10px;}
    .pill{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }
    .cta{
      border:none;
      cursor:pointer;
      padding:10px 14px;
      border-radius:12px;
      color:#fff;
      font-weight:800;
      background: linear-gradient(135deg, rgba(46,107,255,1), rgba(0,229,255,.65));
      box-shadow: 0 18px 50px rgba(46,107,255,.18);
    }

    /* Sections */
    .section{display:none; padding:26px 0 60px;}
    .section.active{display:block;}
    .hero{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:22px;
      align-items:center;
      padding:30px 0 10px;
    }
    .hero h1{
      margin:0 0 12px;
      font-size:44px;
      line-height:1.05;
      letter-spacing:-.6px;
    }
    .hero p{
      margin:0 0 18px;
      color:var(--muted);
      font-size:15px;
      line-height:1.7;
      max-width:60ch;
    }
    .hero .badges{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 18px}
    .badge{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }
    .hero-card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:24px;
      padding:16px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      min-height:280px;
    }
    .hero-card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(260px 200px at 15% 20%, rgba(46,107,255,.28), transparent 60%),
        radial-gradient(260px 200px at 70% 40%, rgba(0,229,255,.18), transparent 60%),
        radial-gradient(260px 200px at 50% 90%, rgba(61,255,181,.14), transparent 60%);
      filter: blur(1px);
      pointer-events:none;
    }
    .mock-ui{
      position:relative;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(5,8,16,.55);
      height:100%;
      min-height:250px;
      overflow:hidden;
    }
    .mock-top{
      display:flex; gap:8px; align-items:center;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color:var(--muted);
      font-size:12px;
    }
    .mock-dot{width:8px; height:8px; border-radius:99px; background: rgba(255,255,255,.12)}
    .mock-body{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:10px;
      padding:12px;
    }
    .mock-panel{
      border:1px solid rgba(255,255,255,.09);
      border-radius:14px;
      background: rgba(255,255,255,.03);
      min-height:160px;
      position:relative;
      overflow:hidden;
    }
    .glow-ring{
      position:absolute; inset:0;
      background:
        radial-gradient(120px 120px at 30% 35%, rgba(0,229,255,.22), transparent 60%),
        radial-gradient(160px 160px at 70% 65%, rgba(46,107,255,.22), transparent 60%);
      pointer-events:none;
      filter: blur(1px);
    }
    .mock-title{
      position:absolute; top:10px; left:10px;
      font-size:12px; color:var(--muted);
    }
    .mock-cards{
      display:grid; grid-template-columns:1fr 1fr;
      gap:8px; padding:34px 10px 10px;
    }
    .mini-card{
      height:46px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(46,107,255,.08);
    }

    .grid-3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:14px;
      margin-top:18px;
    }
    .card{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.28);
    }
    .card h3{margin:0 0 8px; font-size:16px}
    .card p{margin:0; color:var(--muted); line-height:1.65; font-size:13px}
    .kpi{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}
    .kpi span{
      font-size:12px; color:var(--muted);
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      padding:6px 10px; border-radius:999px;
    }

    /* Study layout */
    .study-grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:16px;
    }
    .viewer{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 22px;
      overflow:hidden;
      box-shadow: var(--shadow);
      min-height:520px;
      position:relative;
    }
    .viewer .viewer-top{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }
    .viewer-title{
      display:flex; flex-direction:column; gap:2px;
    }
    .viewer-title b{font-size:14px}
    .viewer-title span{font-size:12px; color:var(--muted)}
    .viewer-actions{display:flex; gap:8px; align-items:center;}
    .btn{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:650;
      font-size:12px;
      transition:.15s ease;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.05)}
    .btn.primary{
      border:none;
      background: linear-gradient(135deg, rgba(46,107,255,1), rgba(0,229,255,.55));
    }
    #threeCanvas{
      width:100%;
      height:calc(100% - 56px);
      display:block;
    }
    .viewer-hint{
      position:absolute; left:14px; bottom:14px;
      color:rgba(255,255,255,.72);
      font-size:12px;
      padding:8px 10px;
      border-radius:12px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.08);
    }

    .side{
      display:grid;
      grid-template-rows: 1fr .9fr;
      gap:14px;
      min-height:520px;
    }
    .panel{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 22px;
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .panel-top{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .panel-top b{font-size:14px}
    .panel-top span{font-size:12px; color:var(--muted)}
    .panel-body{
      padding:12px;
      overflow:auto;
      min-height:0;
    }
    .chat-log{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .msg{
      max-width:92%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      font-size:13px;
      line-height:1.55;
    }
    .msg.user{
      align-self:flex-end;
      background: rgba(46,107,255,.12);
      border-color: rgba(46,107,255,.22);
    }
    .msg.ai{
      align-self:flex-start;
      background: rgba(0,229,255,.08);
      border-color: rgba(0,229,255,.16);
    }
    .panel-bottom{
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.08);
      display:flex; gap:8px;
      background: rgba(0,0,0,.12);
    }
    input, textarea{
      width:100%;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      outline:none;
      font-size:13px;
    }
    input::placeholder, textarea::placeholder{color:rgba(234,240,255,.45)}
    .send{
      width:110px;
      border:none;
      border-radius:14px;
      cursor:pointer;
      color:#fff;
      font-weight:800;
      background: linear-gradient(135deg, rgba(46,107,255,1), rgba(0,229,255,.60));
    }

    .notes{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .note{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius:16px;
      padding:10px 12px;
    }
    .note small{color:var(--muted)}
    .note p{margin:6px 0 0; color:rgba(234,240,255,.9); line-height:1.55; font-size:13px}

    /* Library page */
    .deck{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:14px;
      margin-top:18px;
    }
    .subject{
      border:1px solid var(--line);
      border-radius: 22px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
    }
    .subject-top{
      padding:14px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }
    .subject-top b{font-size:14px}
    .subject-top .tag{
      font-size:12px; color:rgba(255,255,255,.85);
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(46,107,255,.10);
    }
    .subject-body{padding:14px}
    .list{display:flex; flex-direction:column; gap:8px; margin-top:12px}
    .item{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
    }
    .item span{color:var(--muted); font-size:12px}
    .item b{font-size:13px}

    .footer{
      border-top:1px solid var(--line);
      padding:20px 0;
      color:rgba(234,240,255,.55);
      font-size:12px;
    }

    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
      .study-grid{grid-template-columns:1fr}
      .side{grid-template-rows:auto}
      .grid-3{grid-template-columns:1fr}
      .deck{grid-template-columns:1fr}
      .brand{min-width:auto}
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <span class="dot"></span>
        <span>SIMVEX</span>
      </div>

      <nav class="nav" aria-label="Main Navigation">
        <div class="tab active" data-target="home">Home</div>
        <div class="tab" data-target="study">Study</div>
        <div class="tab" data-target="cad">CAD</div>
        <div class="tab" data-target="lab">Lab</div>
      </nav>

      <div class="right-actions">
        <div class="pill">3D Viewer · AI Assistant · Memo</div>
        <button class="cta" id="goStudy">바로 학습 시작</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- HOME -->
    <section class="section active" id="home">
      <div class="hero">
        <div>
          <h1>복잡한 기계(분자) 구조를<br/>3D 시각화로 이해하는 학습</h1>
          <p>
            SIMVEX는 공학·과학 분야 학생/연구자를 위해
            <b>3D 뷰어 기반 구조 학습</b>과 <b>AI 실시간 학습 보조</b>,
            <b>메모 기록</b>을 한 화면에 묶은 학습 솔루션 MVP입니다.
          </p>
          <div class="badges">
            <span class="badge">01. 3D 뷰어</span>
            <span class="badge">02. AI 어시스턴트</span>
            <span class="badge">03. 메모장</span>
            <span class="badge">기계공학 · 생명공학 · 의공학</span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn primary" id="goStudy2">Study 화면 보기</button>
            <button class="btn" id="seedDemo">데모 데이터 채우기</button>
          </div>

          <div class="grid-3">
            <div class="card">
              <h3>3D 뷰어</h3>
              <p>부품을 분해/회전/확대하며 구조를 직관적으로 학습합니다. (MVP는 간단한 3D 오브젝트로 대체)</p>
              <div class="kpi">
                <span>Rotate</span><span>Zoom</span><span>Explode(추후)</span>
              </div>
            </div>
            <div class="card">
              <h3>AI 어시스턴트</h3>
              <p>현재 보고 있는 구조/내용을 기반으로 질문에 답하고, 핵심 개념을 요약해줍니다. (해커톤용 템플릿 응답)</p>
              <div class="kpi">
                <span>요약</span><span>질문응답</span><span>퀴즈(추후)</span>
              </div>
            </div>
            <div class="card">
              <h3>메모장</h3>
              <p>학습 중 떠오르는 포인트를 즉시 기록하고, 주제별로 정리합니다.</p>
              <div class="kpi">
                <span>자동 타임스탬프</span><span>태그(추후)</span><span>내보내기(추후)</span>
              </div>
            </div>
          </div>
        </div>

        <div class="hero-card">
          <div class="mock-ui">
            <div class="mock-top">
              <span class="mock-dot"></span><span class="mock-dot"></span><span class="mock-dot"></span>
              <span style="margin-left:10px;">SIMVEX · Study</span>
            </div>
            <div class="mock-body">
              <div class="mock-panel">
                <div class="mock-title">3D Viewer</div>
                <div class="glow-ring"></div>
              </div>
              <div class="mock-panel">
                <div class="mock-title">AI Assistant</div>
                <div class="mock-cards">
                  <div class="mini-card"></div>
                  <div class="mini-card"></div>
                  <div class="mini-card"></div>
                  <div class="mini-card"></div>
                </div>
              </div>
              <div class="mock-panel" style="grid-column:1 / -1; min-height:92px;">
                <div class="mock-title">Memo</div>
                <div class="glow-ring"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- STUDY -->
    <section class="section" id="study">
      <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div>
          <h2 style="margin:0 0 6px;">Study · 3D 구조 학습</h2>
          <div style="color:var(--muted); font-size:13px; line-height:1.6;">
            왼쪽: 3D 뷰어(데모) / 오른쪽: AI 어시스턴트 + 메모장
          </div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <select id="topicSelect" class="btn" style="padding:8px 12px;">
            <option value="turbine">터빈(기계)</option>
            <option value="molecule">분자 구조(생명)</option>
            <option value="heart">심장 구조(의공)</option>
          </select>
          <button class="btn" id="resetCam">카메라 리셋</button>
          <button class="btn primary" id="toggleSpin">회전 ON/OFF</button>
        </div>
      </div>

      <div class="study-grid">
        <div class="viewer">
          <div class="viewer-top">
            <div class="viewer-title">
              <b id="viewerName">터빈(기계) · Demo Model</b>
              <span id="viewerDesc">부품 구조를 회전/확대해서 확인하세요 (마우스 드래그/휠)</span>
            </div>
            <div class="viewer-actions">
              <button class="btn" id="explodeBtn" title="해커톤에서는 UI만">Explode(추후)</button>
              <button class="btn" id="snapshotBtn" title="스크린샷 저장(기능은 간단)">Snapshot</button>
            </div>
          </div>
          <canvas id="threeCanvas"></canvas>
          <div class="viewer-hint">Tip: 드래그=회전 · 휠=줌 · 우클릭 드래그=이동</div>
        </div>

        <div class="side">
          <div class="panel" id="aiPanel">
            <div class="panel-top">
              <div>
                <b>AI 어시스턴트</b><br/>
                <span id="aiContext">컨텍스트: 터빈(기계)</span>
              </div>
              <button class="btn" id="makeQuiz">퀴즈 만들기</button>
            </div>

            <div class="panel-body">
              <div class="chat-log" id="chatLog">
                <div class="msg ai">안녕하세요! 지금 보고 있는 구조에서 궁금한 점을 물어보면 핵심 원리와 학습 포인트로 정리해드릴게요.</div>
              </div>
            </div>

            <div class="panel-bottom">
              <input id="chatInput" placeholder="예) 이 부품은 어떤 역할을 해?" />
              <button class="send" id="sendBtn">전송</button>
            </div>
          </div>

          <div class="panel" id="memoPanel">
            <div class="panel-top">
              <div>
                <b>메모장</b><br/>
                <span>학습 중 핵심 포인트를 즉시 기록</span>
              </div>
              <button class="btn" id="addQuickNote">+ 빠른 메모</button>
            </div>

            <div class="panel-body">
              <div class="notes" id="notes"></div>
            </div>

            <div class="panel-bottom">
              <input id="noteInput" placeholder="메모를 입력하고 Enter" />
              <button class="send" id="noteBtn">저장</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CAD -->
    <section class="section" id="cad">
      <h2 style="margin:0 0 8px;">CAD · 설계/모델 관리 (MVP)</h2>
      <div style="color:var(--muted); font-size:13px; line-height:1.7; max-width:70ch;">
        해커톤에서는 “화면 흐름”을 보여주기 위한 탭입니다. 실제 MVP 확장 시:
        모델 업로드(GLB/OBJ), 파트 트리, 레이어/재질, 측정(거리/각도) 등을 붙이면 됩니다.
      </div>

      <div class="grid-3" style="margin-top:16px;">
        <div class="card">
          <h3>모델 업로드</h3>
          <p>GLB/OBJ 업로드 → 미리보기 → 학습 콘텐츠와 연결(메타데이터)</p>
        </div>
        <div class="card">
          <h3>파트 트리</h3>
          <p>부품 계층 구조 표시 → 클릭 시 하이라이트/설명</p>
        </div>
        <div class="card">
          <h3>버전 관리</h3>
          <p>버전별 변경점 기록/비교 (프로젝트 기반)</p>
        </div>
      </div>
    </section>

    <!-- LAB -->
    <section class="section" id="lab">
      <h2 style="margin:0 0 8px;">Lab · 전공 과목 라이브러리</h2>
      <div style="color:var(--muted); font-size:13px; line-height:1.7; max-width:70ch;">
        설계도에 나온 것처럼 전공(기계/생명/의공) 콘텐츠를 묶어서,
        사용자가 “융합 지식/기술”을 만들 수 있는 흐름을 위한 페이지입니다.
      </div>

      <div class="deck">
        <div class="subject">
          <div class="subject-top">
            <b>기계공학</b>
            <span class="tag">Mechanical</span>
          </div>
          <div class="subject-body">
            <div style="color:var(--muted); font-size:13px; line-height:1.6;">
              터빈/기어/펌프 등 기계 구조를 3D로 학습
            </div>
            <div class="list">
              <div class="item"><b>가스터빈 구조</b><span>3D · 실습</span></div>
              <div class="item"><b>감속기(기어) 원리</b><span>개념 · 퀴즈</span></div>
              <div class="item"><b>유체 흐름(기초)</b><span>요약 · 문제</span></div>
            </div>
          </div>
        </div>

        <div class="subject">
          <div class="subject-top">
            <b>생명공학</b>
            <span class="tag">Bio</span>
          </div>
          <div class="subject-body">
            <div style="color:var(--muted); font-size:13px; line-height:1.6;">
              분자/세포 구조를 시각화해서 학습
            </div>
            <div class="list">
              <div class="item"><b>단백질 접힘</b><span>3D · 개념</span></div>
              <div class="item"><b>세포 소기관</b><span>암기 · 정리</span></div>
              <div class="item"><b>DNA 복제</b><span>요약 · 문제</span></div>
            </div>
          </div>
        </div>

        <div class="subject">
          <div class="subject-top">
            <b>의공학</b>
            <span class="tag">Medical</span>
          </div>
          <div class="subject-body">
            <div style="color:var(--muted); font-size:13px; line-height:1.6;">
              인체 구조/의료기기 기초를 3D 기반으로 학습
            </div>
            <div class="list">
              <div class="item"><b>심장 해부학</b><span>3D · 학습</span></div>
              <div class="item"><b>혈류와 밸브</b><span>원리 · 퀴즈</span></div>
              <div class="item"><b>기초 의료영상</b><span>개념 · 정리</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="footer">
      © SIMVEX MVP · Hackathon Prototype (Static HTML)
    </div>
  </main>

  <!-- Three.js (CDN) -->
  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";

    // ---------- Simple router ----------
    const tabs = document.querySelectorAll(".tab");
    const sections = document.querySelectorAll(".section");
    function go(id){
      sections.forEach(s => s.classList.toggle("active", s.id === id));
      tabs.forEach(t => t.classList.toggle("active", t.dataset.target === id));
      window.scrollTo({top:0, behavior:"smooth"});
    }
    tabs.forEach(t => t.addEventListener("click", () => go(t.dataset.target)));
    document.getElementById("goStudy").addEventListener("click", () => go("study"));
    document.getElementById("goStudy2").addEventListener("click", () => go("study"));

    // ---------- Demo data ----------
    const notesEl = document.getElementById("notes");
    const seedBtn = document.getElementById("seedDemo");
    const quickBtn = document.getElementById("addQuickNote");

    function nowStamp(){
      const d = new Date();
      const pad = (n)=> String(n).padStart(2,"0");
      return `${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }
    function addNote(text){
      const wrap = document.createElement("div");
      wrap.className = "note";
      wrap.innerHTML = `<small>${nowStamp()}</small><p>${escapeHtml(text)}</p>`;
      notesEl.prepend(wrap);
    }
    function escapeHtml(str){
      return str.replaceAll("&","&amp;")
                .replaceAll("<","&lt;")
                .replaceAll(">","&gt;")
                .replaceAll('"',"&quot;")
                .replaceAll("'","&#039;");
    }

    seedBtn.addEventListener("click", () => {
      go("study");
      addNote("터빈 로터의 역할: 회전 에너지를 생성/전달. 하우징과의 간섭 체크 필요.");
      addNote("질문: 블레이드 각도(피치)가 효율에 미치는 영향은?");
      addNote("다음 학습: 압축기 → 연소기 → 터빈 순서로 에너지 변환 흐름 정리.");
    });

    quickBtn.addEventListener("click", () => addNote("핵심 포인트를 한 줄로 요약해보자."));

    // memo input
    const noteInput = document.getElementById("noteInput");
    const noteBtn = document.getElementById("noteBtn");
    function saveNote(){
      const v = noteInput.value.trim();
      if(!v) return;
      addNote(v);
      noteInput.value = "";
    }
    noteBtn.addEventListener("click", saveNote);
    noteInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") saveNote();
    });

    // ---------- AI Chat (mock) ----------
    const chatLog = document.getElementById("chatLog");
    const chatInput = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    const makeQuiz = document.getElementById("makeQuiz");
    const aiContext = document.getElementById("aiContext");

    let currentTopic = "turbine";
    const topicInfo = {
      turbine: { name:"터빈(기계)", hint:["구성요소","에너지 변환","효율","유동/압력"] },
      molecule:{ name:"분자 구조(생명)", hint:["결합","구조 안정성","기능","상호작용"] },
      heart:  { name:"심장 구조(의공)", hint:["혈류","판막","전도계","압력/순환"] }
    };

    function appendMsg(role, text){
      const el = document.createElement("div");
      el.className = `msg ${role}`;
      el.textContent = text;
      chatLog.appendChild(el);
      chatLog.parentElement.scrollTop = chatLog.parentElement.scrollHeight;
    }

    function mockAnswer(q){
      const { name, hint } = topicInfo[currentTopic];
      const h = hint[Math.floor(Math.random()*hint.length)];
      return [
        `(${name} 기준) 질문 요약: "${q}"`,
        `핵심 관점: ${h}`,
        `설명: 지금 보이는 구조에서 "${h}"를 중심으로 보면 이해가 빨라요.`,
        `체크리스트: ① 주요 부품 역할 ② 입력/출력(힘·유량·전압 등) ③ 병목 구간`,
        `다음 질문 추천: "이 구조에서 가장 중요한 파라미터는 뭐야?"`
      ].join("\n");
    }

    function send(){
      const q = chatInput.value.trim();
      if(!q) return;
      appendMsg("user", q);
      chatInput.value = "";

      // Fake latency
      const thinking = document.createElement("div");
      thinking.className = "msg ai";
      thinking.textContent = "생각 중...";
      chatLog.appendChild(thinking);
      chatLog.parentElement.scrollTop = chatLog.parentElement.scrollHeight;

      setTimeout(() => {
        thinking.remove();
        appendMsg("ai", mockAnswer(q));
      }, 450);
    }

    sendBtn.addEventListener("click", send);
    chatInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") send();
    });

    makeQuiz.addEventListener("click", () => {
      const { name } = topicInfo[currentTopic];
      appendMsg("ai",
        `[퀴즈] ${name}\n1) 이 구조의 입력과 출력은 무엇일까요?\n2) 병목(효율 저하) 지점 후보 1가지를 말해보세요.\n3) 개선 아이디어 1가지를 적어보세요.`
      );
    });

    // ---------- Three.js Viewer (demo) ----------
    const canvas = document.getElementById("threeCanvas");
    const viewerName = document.getElementById("viewerName");
    const viewerDesc = document.getElementById("viewerDesc");
    const topicSelect = document.getElementById("topicSelect");
    const resetCam = document.getElementById("resetCam");
    const toggleSpin = document.getElementById("toggleSpin");
    const snapshotBtn = document.getElementById("snapshotBtn");

    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true, preserveDrawingBuffer:true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x070A12, 6, 18);

    const camera = new THREE.PerspectiveCamera(55, 1, 0.1, 100);
    camera.position.set(3.2, 2.2, 4.6);

    const controls = new OrbitControls(camera, canvas);
    controls.enableDamping = true;

    // lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.55));
    const key = new THREE.DirectionalLight(0x9bbdff, 1.1);
    key.position.set(3, 5, 2);
    scene.add(key);

    const rim = new THREE.PointLight(0x00e5ff, 1.2, 20);
    rim.position.set(-4, 2, -2);
    scene.add(rim);

    // floor
    const floorGeo = new THREE.PlaneGeometry(50, 50);
    const floorMat = new THREE.MeshStandardMaterial({ color:0x0b1020, metalness:0.2, roughness:0.85 });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.position.y = -1.4;
    scene.add(floor);

    // object group (changes per topic)
    const group = new THREE.Group();
    scene.add(group);

    function clearGroup(){
      while(group.children.length){
        const m = group.children.pop();
        m.geometry?.dispose?.();
        if(m.material){
          if(Array.isArray(m.material)) m.material.forEach(mm=>mm.dispose?.());
          else m.material.dispose?.();
        }
      }
    }

    function makeMaterial(base){
      return new THREE.MeshStandardMaterial({
        color: base,
        metalness: 0.7,
        roughness: 0.25,
        emissive: 0x000000
      });
    }

    function buildFor(topic){
      clearGroup();

      if(topic === "turbine"){
        viewerName.textContent = "터빈(기계) · Demo Model";
        viewerDesc.textContent = "회전 에너지/유동 관점으로 구조를 관찰해보세요.";
        aiContext.textContent = "컨텍스트: 터빈(기계)";

        // turbine-ish: ring + blades
        const ring = new THREE.Mesh(
          new THREE.TorusGeometry(1.1, 0.25, 22, 90),
          makeMaterial(0x2e6bff)
        );
        ring.rotation.x = Math.PI/2;
        group.add(ring);

        const hub = new THREE.Mesh(
          new THREE.CylinderGeometry(0.35, 0.45, 1.4, 32),
          makeMaterial(0x8aa7ff)
        );
        hub.rotation.z = Math.PI/2;
        group.add(hub);

        for(let i=0;i<14;i++){
          const blade = new THREE.Mesh(
            new THREE.BoxGeometry(0.1, 0.7, 0.22),
            makeMaterial(0x00e5ff)
          );
          const a = (i/14)*Math.PI*2;
          blade.position.set(Math.cos(a)*1.0, Math.sin(a)*1.0, 0);
          blade.lookAt(0,0,0);
          blade.rotation.x += Math.PI/2;
          group.add(blade);
        }
      }

      if(topic === "molecule"){
        viewerName.textContent = "분자 구조(생명) · Demo Model";
        viewerDesc.textContent = "결합/상호작용을 떠올리며 구조 안정성을 해석해보세요.";
        aiContext.textContent = "컨텍스트: 분자 구조(생명)";

        // molecule-ish: spheres + bonds
        const atomMatA = new THREE.MeshStandardMaterial({ color:0x00e5ff, metalness:.25, roughness:.25 });
        const atomMatB = new THREE.MeshStandardMaterial({ color:0x2e6bff, metalness:.25, roughness:.25 });
        const bondMat = new THREE.MeshStandardMaterial({ color:0x7fe8ff, metalness:.6, roughness:.2 });

        const atoms = [];
        for(let i=0;i<10;i++){
          const r = 0.18 + Math.random()*0.10;
          const atom = new THREE.Mesh(new THREE.SphereGeometry(r, 32, 24), (i%2?atomMatA:atomMatB));
          atom.position.set((Math.random()-0.5)*2.2, (Math.random()-0.5)*1.6, (Math.random()-0.5)*1.6);
          atoms.push(atom);
          group.add(atom);
        }
        function bond(a,b){
          const dir = new THREE.Vector3().subVectors(b.position, a.position);
          const len = dir.length();
          const cyl = new THREE.Mesh(new THREE.CylinderGeometry(0.05,0.05,len,18), bondMat);
          cyl.position.copy(a.position).addScaledVector(dir, 0.5);
          cyl.quaternion.setFromUnitVectors(new THREE.Vector3(0,1,0), dir.normalize());
          group.add(cyl);
        }
        for(let i=0;i<atoms.length-1;i++){
          bond(atoms[i], atoms[i+1]);
        }
      }

      if(topic === "heart"){
        viewerName.textContent = "심장 구조(의공) · Demo Model";
        viewerDesc.textContent = "혈류 흐름(유입/유출)과 판막 역할을 중심으로 보세요.";
        aiContext.textContent = "컨텍스트: 심장 구조(의공)";

        // heart-ish: organic blobs (icosahedrons) + tubes
        const body = new THREE.Mesh(
          new THREE.IcosahedronGeometry(1.05, 1),
          new THREE.MeshStandardMaterial({ color:0x2e6bff, metalness:.35, roughness:.25 })
        );
        body.scale.set(1, 1.15, 0.85);
        group.add(body);

        const chamber = new THREE.Mesh(
          new THREE.IcosahedronGeometry(0.65, 1),
          new THREE.MeshStandardMaterial({ color:0x00e5ff, metalness:.35, roughness:.25 })
        );
        chamber.position.set(0.65, -0.15, 0.2);
        chamber.scale.set(0.9, 1.0, 0.8);
        group.add(chamber);

        const tubeMat = new THREE.MeshStandardMaterial({ color:0x86f7ff, metalness:.6, roughness:.18 });
        const tube1 = new THREE.Mesh(new THREE.TorusGeometry(0.55, 0.08, 16, 60), tubeMat);
        tube1.position.set(-0.55, 0.55, 0.2);
        tube1.rotation.y = Math.PI/2;
        group.add(tube1);

        const tube2 = new THREE.Mesh(new THREE.TorusGeometry(0.45, 0.07, 16, 60), tubeMat);
        tube2.position.set(0.55, 0.75, -0.15);
        tube2.rotation.x = Math.PI/2;
        group.add(tube2);
      }

      currentTopic = topic;
    }

    buildFor(currentTopic);

    // render sizing
    function resize(){
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(1, rect.width);
      const h = Math.max(1, rect.height);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h, false);
    }
    window.addEventListener("resize", resize);
    resize();

    // animation
    let spinning = true;
    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      if(spinning){
        group.rotation.y += 0.006;
        group.rotation.x += 0.0015;
      }
      renderer.render(scene, camera);
    }
    animate();

    // controls
    topicSelect.addEventListener("change", (e) => {
      buildFor(e.target.value);
      appendMsg("ai", `컨텍스트가 "${topicInfo[currentTopic].name}"로 변경됐어요. 궁금한 점을 질문해보세요!`);
    });

    resetCam.addEventListener("click", () => {
      camera.position.set(3.2, 2.2, 4.6);
      controls.target.set(0,0,0);
      controls.update();
    });

    toggleSpin.addEventListener("click", () => {
      spinning = !spinning;
      toggleSpin.textContent = spinning ? "회전 ON/OFF" : "회전 OFF(정지됨)";
    });

    document.getElementById("explodeBtn").addEventListener("click", () => {
      appendMsg("ai", "Explode는 해커톤 MVP에선 UI만 준비했어요. (다음 단계: 파트별 분리/하이라이트)");
    });

    snapshotBtn.addEventListener("click", () => {
      const dataUrl = canvas.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = dataUrl;
      a.download = `simvex_snapshot_${Date.now()}.png`;
      a.click();
      addNote("스냅샷 저장: 뷰어 화면을 캡처했습니다.");
    });

    // optional: start on Home but ensure study resizing when switched
    const observer = new MutationObserver(() => {
      // when study section becomes active, resize canvas properly
      const studyActive = document.getElementById("study").classList.contains("active");
      if(studyActive) setTimeout(resize, 60);
    });
    observer.observe(document.body, { attributes:true, subtree:true, attributeFilter:["class"] });

  </script>
</body>
</html>
